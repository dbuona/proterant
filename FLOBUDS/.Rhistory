vivo$Lbb_day<-ifelse(is.na(vivo$Lbb_day),120,vivo$Lbb_day)
vivo$surv<-ifelse(vivo$Lbb==120,0,1)
surv_object<-Surv(time=vivo$Lbb_day, event = vivo$surv,type="right")
surv_object
ggsurvplot(s1, data =vivo, fun = "event")
s1<-survfit(surv_object ~ Chill+Light+Force, data = vivo)
s1<-survfit(surv_object ~ treatment, data = vivo)
summary(s1)
ggsurvplot(s1, data =vivo, fun = "event")
ggsurvplot(s1, data =vivo, fun = "event")
###################survival analysis###################################
vivo<-filter(d,Dead.alive %in% c("A","?"))
vivo$Lbb_day<-ifelse(is.na(vivo$Lbb_day),120,vivo$Lbb_day)
vivo$Lbb_day<-ifelse(is.na(vivo$Lbb_day),120,vivo$Lbb_day)
vivo$surv<-ifelse(vivo$Lbb==120,0,1)
table(vivo$treatment)
table(d$treatment)
###################survival analysis###################################
vivo<-filter(d,Dead.alive %in% c("A","?"))
table(vivo$treatment)
morto<-filter(d,Dead.alive %!in% c("A","?"))
morto<-filter(d,Dead.alive !%in% c("A","?"))
morto<-filter(d,Dead.alive=="D")
View(morto)
#####First flobuds analysis. Question: How does first flowering (60), change relative to first leafout day (15)?
# Begun by Dan on April 13 2018
setwd("~/Documents/git/proterant/FLOBUDS")
source("cleaning.R")
#############CREATE A DATA SHEET THAT HAS THE THREE FLOWER TYPES IN SEPARATE COLUMNS#########################
#################THIS WILL BE USEFUL FOR COMPARING CHANGES IN PROTANDRY OR PROTOGYNY######################
####find the first day when species reached 15
d.leaf<-filter(dx,leafphase==15)
first<-aggregate(d.leaf$doy.final, by = list(d.leaf$id), min)
####combine with all data
dater<-as.data.frame(unique(dx$id))
colnames(dater)<- c("id")
colnames(first)<-c("id","leaf_day")
dater<-full_join(dater,first,by="id") ###now you have a data set with first leaves
### flowers (currrently mixed only)
unique(dx$flophase)
d.flo<-filter(dx,flophase==60) ###This is all the 60s ever I have
firstflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),min )
colnames(firstflo)<-c("id","flo_day")
dater<-full_join(dater,firstflo,by="id")
###add female
d.floF<-filter(dx,flophase=="60-F")
firstfloF<-aggregate(d.floF$doy.final, by = list(d.floF$id), min) ##This stage is problematc
colnames(firstfloF)<-c("id","flo_dayF")
dater<-full_join(dater,firstfloF,by="id")
###add male
d.floM<-filter(dx,flophase=="60-M")
firstfloM<-aggregate(d.floM$doy.final, by = list(d.floM$id), min)
colnames(firstfloM)<-c("id","flo_dayM")
dater<-full_join(dater,firstfloM,by="id")
##### pull experimenta; information to merge. THis give a full data sheet
###in which male, female and mixd flowering can be compared
dxx<-dplyr::select(dx,1:7)
dxx<-distinct(dxx)
good.dat<-left_join(dater,dxx)
###make a dichogamy sheet
mono<-filter(good.dat, GEN.SPA %in% c( "COM.PER","COR.COR"))
#write.csv(mono,"dicogamy.csv")
###continue
good.dat<-gather(good.dat,sex,DOY,2:5)
#good.dat<-unite(good.dat,treatment,Force,Light,Chill,sep="" )
#ggplot(good.dat,aes(x=treatment,y=flo_day_Mon, color=sex))+geom_point()+facet_wrap(~GEN.SPA)
#ggplot(good.dat,aes(x=treatment,y=DOY))+stat_summary(aes(color=sex))+geom_point(size=0.2,aes(color=sex))+facet_wrap(~GEN.SPA)
##########################################################################################
############MAKE A DATE SHEET THAT AGGREGATES ALL FLOWER TO EVALUATE COARSE HYSTERANTHY############
DAT<-separate(dx,flophase,c("abosolute_flower","sex_ind"),sep="-")
L<-filter(DAT,leafphase==9)
L1<-aggregate(L$doy.final, by = list(L$id), min)
datUM<-as.data.frame(unique(DAT$id))
colnames(datUM)<- c("id")
colnames(L1)<-c("id","Lbb_day")
datUM<-full_join(datUM,L1,by="id") ###now you have a data set with first leaves
### flowers (currrently mixed only)
Fl<-filter(DAT,abosolute_flower==60)
Fl1<-aggregate(Fl$doy.final, by = list(Fl$id), min)
colnames(Fl1)<-c("id","flo_day")
datUM<-full_join(datUM,Fl1,by="id")
great.dat<-left_join(datUM,dxx)
##add leeaf out
LLL<-filter(DAT,leafphase==15)
L3<-aggregate(LLL$doy.final, by = list(LLL$id), min)
datUM3<-as.data.frame(unique(DAT$id))
colnames(datUM3)<- c("id")
colnames(L3)<-c("id","leaf_day")
great.dat<-left_join(great.dat,L3)
###add expansion
LL<-filter(DAT,leafphase==11)
L2<-aggregate(LL$doy.final, by = list(LL$id), min)
datUM2<-as.data.frame(unique(DAT$id))
colnames(datUM2)<- c("id")
colnames(L2)<-c("id","Lexpand_day")
great.dat<-left_join(great.dat,L2)
ncol(great.dat)
great.dat<-great.dat[,c(1,4,5,6,7,8,9,3,2,10,11)]
###add survival analysis columns
surv<-read.csv("survival.eval.csv",header=TRUE)
View(surv)
###add survival analysis columns
surv<-read.csv("flobuds.eval.csv",header=TRUE)
colnames(surv)
colnames(surv)
surv<-unite(surv,treatcode,Force,Light,Chill,sep="_",remove = FALSE)
surv$Light<-ifelse(surv$treatcode=="W_S_0","L",surv$Light)
surv$Light<-ifelse(surv$treatcode=="W_L_0","S",surv$Light)
View(surv)
colnames(great.dat)
View(dx)
head(great.dat)
surv<-unite(surv,id,name,good_flaskid,sep="_")
intersect(surv$id,great.dat$id)
datty<-left_join(great.dat,surv)
View(datty)
##a data sheet for first analysis
write.csv(datty,"first.event.dat.csv")
rm(list=ls())
options(stringsAsFactors = FALSE)
graphics.off()
library(ggplot2)
library(tidyverse)
library(brms)
library(rstan)
library(arm)
library(rstanarm)
library(tibble)
library(ggstance)
library(survival)
library(survminer)
setwd("~/Documents/git/proterant/FLOBUDS")
d<-read.csv("first.event.dat.csv",header=TRUE)
###get rid of useless colummns
colnames(d)
d<-dplyr::select(d, -X.1)
d<-dplyr::select(d, -X)
#### make light differsent so variables  appear in order
d$Light<-ifelse(d$Light=="L","xL","S")
###name treatments numeric/continuous
d$photoperiod<-ifelse(d$Light=="xL",12,8)
d$temp_day<-ifelse(d$Force=="W",24,18)
d$temp_night<-ifelse(d$Force=="W",18,12)
d$chilldays<-ifelse(d$Chill==0,28,56)
###center predictors
d$p_cent<-d$photoperiod/mean(d$photoperiod)
d$f_cent<-d$temp_day/mean(d$temp_day)
d$c_cent<-d$chilldays/mean(d$chilldays)
###what is the distrbution of response variables
ggplot(d,aes(flo_day))+geom_density()
ggplot(d,aes(leaf_day))+geom_density()
ggplot(d,aes(Lbb_day))+geom_density()
ggplot(d,aes(Lexpand_day))+geom_density()
d<-unite(d, treatment, Force,Light, Chill, sep= "_",remove = FALSE)
###Basic plots for each phenophase#############################################
phased<-gather(d,phase,DOY,8:12)
bbview<-filter(phased, phase %in% c("Lbb_day","flo_day"))
expview<-filter(phased, phase %in% c("Lexpand_day","flo_day"))
leafview<-filter(phased, phase %in% c("leaf_day","flo_day"))
##filter to species that have goodish flowering and BB
bigsp<-filter(bbview, GEN.SPA %in% c("ACE.PEN", "COM.PER","COR.COR","ILE.MUC", "PRU.PEN","VAC.COR"))
ggplot(bigsp,aes(treatment,as.numeric(DOY)))+geom_point(aes(color=phase),size=0.5)+stat_summary(fun.data = "mean_cl_boot",aes(color=phase))+ggtitle("budburst vs. flower")+facet_wrap(~GEN.SPA)
###expansion and flowering
bigsp<-filter(expview, GEN.SPA %in% c("ACE.PEN", "COM.PER","COR.COR","ILE.MUC", "PRU.PEN","VAC.COR"))
ggplot(bigsp,aes(treatment,as.numeric(DOY)))+geom_point(aes(color=phase),size=0.5)+stat_summary(fun.data = "mean_cl_boot",aes(color=phase))+ggtitle("expansion vs. flower")+facet_wrap(~GEN.SPA)
###leafout and flowering
bigsp<-filter(leafview, GEN.SPA %in% c("ACE.PEN", "COM.PER","COR.COR","ILE.MUC", "PRU.PEN","VAC.COR"))
ggplot(bigsp,aes(treatment,as.numeric(DOY)))+geom_point(aes(color=phase),size=0.5)+stat_summary(fun.data = "mean_cl_boot",aes(color=phase))+ggtitle("leafout vs. flower")+facet_wrap(~GEN.SPA)
###################survival analysis###################################
vivo<-filter(d,Dead.alive %in% c("A","?"))
###################survival analysis###################################
vivo<-filter(d,Dead.alive %in% c("A","?"))
table(vivo$treatment)
vivo$Lbb_day<-ifelse(is.na(vivo$Lbb_day),120,vivo$Lbb_day)
vivo$surv<-ifelse(vivo$Lbb==120,0,1)
table(vivo$treatment)
table(d$treatment)
surv_object<-Surv(time=vivo$Lbb_day, event = vivo$surv,type="right")
s1<-survfit(surv_object ~ treatment, data = vivo)
ggsurvplot(s1, data =vivo, fun = "event")
m1<-survreg(Surv(time =vivo$leaf_day, event = vivo$surv)~Chill+Light+Force,data=vivo, dist="gaussian")
summary(m1)
?survreg()
m1<-survreg(Surv(time =vivo$leaf_day, event = vivo$surv)~Chill+Light+Force,data=vivo, dist="weibull")
summary(m1)
m1<-survreg(Surv(time =vivo$leaf_day, event = vivo$surv)~Chill+Light+Force,data=vivo, dist="gaussian")
summary(m1)
m1<-survreg(Surv(time =vivo$leaf_day, event = vivo$surv)~Chill+Light+Force+Chill:Light,+Chill:Force+Light:Force,data=vivo, dist="gaussian")
m1<-survreg(Surv(time =vivo$leaf_day, event = vivo$surv)~Chill+Light+Force+Chill:Light+Chill:Force+Light:Force,data=vivo, dist="gaussian")
summary(m1)
coef(m1)
m1<-survreg(Surv(time =vivo$leaf_day, event = vivo$surv)~Chill+Light+Force+Chill:Light+Chill:Force+Light:Force+(1|GEN.SPA),data=vivo, dist="gaussian")
m1<-survreg(Surv(time =vivo$leaf_day, event = vivo$surv)~Chill+Light+Force+Chill:Light+Chill:Force+Light:Force+(|GEN.SPA),data=vivo, dist="gaussian")
m1<-survreg(Surv(time =vivo$leaf_day, event = vivo$surv)~Chill+Light+Force+Chill:Light+Chill:Force+Light:Force,data=vivo, dist="gaussian")
cox<-coxph(Surv(time =vivo$leaf_day, event = vivo$surv)~Chill+Light+Force+Chill:Light+Chill:Force+Light:Force,data=vivo, dist="gaussian"))
cox<-coxph(Surv(time =vivo$leaf_day, event = vivo$surv)~Chill+Light+Force+Chill:Light+Chill:Force+Light:Force,data=vivo, dist="gaussian")
cox<-coxph(Surv(time =vivo$leaf_day, event = vivo$surv)~Chill+Light+Force,data=vivo)
summary(cox)
?coxph()
#compare to bayes
bayes1<-brm(Fbb_day ~ Light+Chill+Force+Light:Chill+Light:Force+Force:Chill),
data = d, family = gaussian,
iter= 3000,
warmup = 2000,
cores = 4)
#compare to bayes
bayes1<-brm(Fbb_day ~ Light+Chill+Force+Light:Chill+Light:Force+Force:Chill)
#compare to bayes
bayes1<-brm(Fbb_day ~ Light+Chill+Force+Light:Chill+Light:Force+Force:Chill)
#compare to bayes
bayes1<-brm(Fbb_day ~ Light+Chill+Force+Light:Chill+Light:Force+Force:Chill,
data = d, family = gaussian,
iter= 3000,
warmup = 2000,
cores = 4)
#compare to bayes
bayes1<-brm(Fbb_day ~ Light+Chill+Force+Light:Chill+Light:Force+Force:Chill,
data = vivo, family = gaussian,
iter= 3000,
warmup = 2000,
cores = 4)
#compare to bayes
bayes1<-brm(Lbb_day ~ Light+Chill+Force+Light:Chill+Light:Force+Force:Chill,
data = vivo, family = gaussian,
iter= 3000,
warmup = 2000,
cores = 4)
summary(bayes1)
m1<-survreg(Surv(time =vivo$Lbb_day, event = vivo$surv)~Chill+Light+Force+Chill:Light+Chill:Force+Light:Force,data=vivo, dist="gaussian")
summary(m1)
###################survival analysis###########Kaplan-Meier########################
vivo<-filter(d,Dead.alive %in% c("A","?"))
table(vivo$treatment)
vivo$Lbb_day<-ifelse(is.na(vivo$Lbb_day),120,vivo$Lbb_day)
vivo$surv<-ifelse(vivo$Lbb==120,0,1)
table(vivo$treatment)
table(d$treatment)
surv_object<-Surv(time=vivo$Lbb_day, event = vivo$surv,type="right")
s1<-survfit(surv_object ~ treatment, data = vivo)
summary(s1)
ggsurvplot(s1, data =vivo, fun = "event")
m1<-survreg(Surv(time =vivo$Lbb_day, event = vivo$surv)~Chill+Light+Force+Chill:Light+Chill:Force+Light:Force,data=vivo, dist="gaussian")
summary(m1)
summary(bayes1)
plot(bayes1)
pp_check(bayes1)
ggplot(d,aes(Lbb_day))+geom_density()
summary(bayes1)
pp_check(bayes1)
#compare to bayes
bayes1<-brm(Lbb_day ~ Light+Chill+Force+Light:Chill+Light:Force+Force:Chill,
data = d, family = gaussian,
iter= 3000,
warmup = 2000,
cores = 4)
summary(bayes1)
pp_check(bayes1)
#compare to bayes
vivo2<-filter(d,Dead.alive %in% c("A","?"))
bayes1<-brm(Lbb_day ~ Light+Chill+Force+Light:Chill+Light:Force+Force:Chill,
data = vivo2, family = gaussian,
iter= 3000,
warmup = 2000,
cores = 4)
summary(bayes1)
pp_check(bayes1)
summary(m1)
m1a<-lm(Lbb_day~Chill+Light+Force+Chill:Light+Chill:Force+Light:Force,data=vivo)
summary(m1a)
summary(m1)
setwd("~/Documents/git/proterant/FLOBUDS")
source("cleaning.R")
DAT<-separate(dx,flophase,c("abosolute_flower","sex_ind"),sep="-")
View(DAT)
View(dx)
unique(dx$flophase)
firstflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),min )
d.flo<-filter(dx,flophase==60) ###This is all the 60s ever I have
firstflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),min )
lastflo<-agregate((d.flo$doy.final, by = list(d.flo$id),max )
lastflo<-agregate(d.flo$doy.final, by = list(d.flo$id),max )
lastflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),max )
colnames(firstflo)<-c("id","flo_day")
dater<-full_join(dater,firstflo,by="id")
dater<-as.data.frame(unique(dx$id))
View(lastflo)
colnames(firstflo)<-c("id","flo_day")
colnames(lastflo)<-c("id","flo_day")
colnames(firstflo)<-c("id","flo_start")
colnames(lastflo)<-c("id","flo_end")
colnames(dater)<- c("id")
dur.dat<-full_join(dater,firstflo,lastflo)
dur.dat<-full_join(firstflo,lastflo)
dur.dat<-full_join(dater,dur.dat)
View(dur.dat)
dur.dat$duration<-dur.dat$flo_start-dur.dat$flo_end
View(dur.dat)
dur.dat$duration<-dur.dat$flo_end-dur.dat$flo_start-
dur.dat$duration<-dur.dat$flo_end-dur.dat$flo_start-
lm(duration~treatment,data=dur.dat)
dur.dat$duration<-dur.dat$flo_end-dur.dat$flo_start-
lm(duration~Chill+Light_Force,data=dur.dat)
dur.dat$duration<-dur.dat$flo_end-dur.dat$flo_start-
lm(duration~Chill+Light+Force,data=dur.dat)
View(dur.dat)
dur.dat$duration<-dur.dat$flo_end-dur.dat$flo_start-
d.flo<-filter(dx,flophase=="60-F")
dur.dat$duration<-dur.dat$flo_end-dur.dat$flo_start-
d.flo<-filter(dx,flophase=="60-F")
dur.dat$duration<-dur.dat$flo_end-dur.dat$flo_start-
d.flo<-filter(dx,flophase=="60-F")
dur.dat$duration<-dur.dat$flo_end-dur.dat$flo_start-
d.floF<-filter(dx,flophase=="60-F")
dur.dat$duration<-dur.dat$flo_end-dur.dat$flo_start-
d.floF<-filter(dx,flophase="60-F")
View(dur.dat)
dur.dat$duration<-dur.dat$flo_end-dur.dat$flo_start
unique(dx$flophase)
d.floM<-filter(dx,flophase=="60-M"
d.floM<-filter(dx,flophase=="60-M"
)
d.floM<-filter(dx,flophase=="60-M")
d.flo<-filter(dx,flophase %in% c(60,"60-M","60-F") ###This is all the 60s ever I have
d.flo<-filter(dx,flophase %in% c(60,"60-M","60-F")) ###This is all the 60s ever I have
d.flo<-filter(dx,flophase %in% c(60,"60-M","60-F")) ###This is all the 60s ever I have
View(d.flo)
table(d.flo$flophase)
firstflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),min )
lastflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),max )
colnames(firstflo)<-c("id","flo_start")
colnames(lastflo)<-c("id","flo_end")
dur.dat<-full_join(firstflo,lastflo)
dur.dat<-full_join(dater,dur.dat)
dur.dat$duration<-dur.dat$flo_end-dur.dat$flo_start
View(dur.dat)
table(d.flo$flophase)
firstflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),min )
lastflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),max )
View(firstflo)
d.flo$sex<-ifelse(d.flo$flophase==60,"bisexual",NA)
d.flo<-filter(dx,flophase %in% c(60,"60-M","60-F"))
table(d.flo$flophase)
d.flo$sex<-ifelse(d.flo$flophase==60,"bisexual","unisex")
d.flo$sex<-ifelse(d.flo$sex=="unisex" & d.flo$flophase=="60-F","female","male")
View(d.flo)
d.flo<-filter(dx,flophase %in% c(60,"60-M","60-F"))
table(d.flo$flophase)
d.flo$sex<-ifelse(d.flo$flophase==60,"bisexual","unisex")
d.flo$sex<-ifelse(d.flo$sex=="unisex" & d.flo$flophase=="60-F","female","male")
d.flo<-filter(dx,flophase %in% c(60,"60-M","60-F"))
d.flo$flophase<-60
firstflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),min )
lastflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),max )
colnames(firstflo)<-c("id","flo_start")
colnames(lastflo)<-c("id","flo_end")
dur.dat<-full_join(firstflo,lastflo)
dur.dat<-full_join(dater,dur.dat)
dur.dat$duration<-dur.dat$flo_end-dur.dat$flo_start
View(dur.dat)
dxx<-dplyr::select(dx,1:7)
dxx<-distinct(dxx)
dur.dat<-left_join(dur.dat,dxx)
View(dur.dat)
dur.dat<-right_join(dur.dat,dxx)
####Duration of flowering
#### overlap of flowering and leaftime
3###May 9 2018
setwd("~/Documents/git/proterant/FLOBUDS")
source("cleaning.R")
dater<-as.data.frame(unique(dx$id))
colnames(dater)<- c("id")
unique(dx$flophase)
d.flo<-filter(dx,flophase %in% c(60,"60-M","60-F"))
d.flo$flophase<-60
firstflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),min )
lastflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),max )
colnames(firstflo)<-c("id","flo_start")
colnames(lastflo)<-c("id","flo_end")
dur.dat<-full_join(firstflo,lastflo)
dur.dat<-full_join(dater,dur.dat)
dur.dat$duration<-dur.dat$flo_end-dur.dat$flo_start
dxx<-dplyr::select(dx,1:7)
dxx<-distinct(dxx)
D<-right_join(dur.dat,dxx)
View(D)
plot(D$duration,D$GEN.SPA)
plot(mean(D$duration),D$GEN.SPA)
ggplot(D,aes(treatment,duration))+stat_summary()
View(D)
D<-unite(D,treatment,Force,Light,Chill,sep="_",remove = FALSE)
ggplot(D,aes(treatment,duration))+stat_summary()
ggplot(D,aes(treatment,duration))+geom_point()
ggplot(D,aes(treatment,duration))+geom_bar()
ggplot(D,aes(treatment,duration))+geom_point(aes(color=GEN.SPA))
View(D)
d.flo<-filter(dx,flophase %in% c(60,"60-M","60-F"))
d.flo$flophase<-60
d.flo<-filter(dx,flophase %in% c(60,"60-M","60-F"))
d.flo<-filter(dx,flophase %in% c(60))
firstflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),min )
lastflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),max )
colnames(firstflo)<-c("id","flo_start")
colnames(lastflo)<-c("id","flo_end")
dur.dat<-full_join(firstflo,lastflo)
dur.dat<-full_join(dater,dur.dat)
dur.dat$duration<-dur.dat$flo_end-dur.dat$flo_start
d.flo<-filter(dx,flophase %in% c(60))
firstflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),min )
lastflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),max )
colnames(firstflo)<-c("id","flo_start")
colnames(lastflo)<-c("id","flo_end")
dur.dat<-full_join(firstflo,lastflo)
dur.dat<-full_join(dater,dur.dat)
dur.dat$duration<-dur.dat$flo_end-dur.dat$flo_start
View(dur.dat)
dur.dat<-na.omit(dur.dat)
d.flo<-filter(dx,flophase %in% c("60-F"))
firstflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),min )
lastflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),max )
colnames(firstflo)<-c("id","flo_start")
dur.dat1<-full_join(firstflo,lastflo)
firstflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),min )
lastflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),max )
colnames(firstflo)<-c("id","flo_start")
colnames(lastflo)<-c("id","flo_end")
dur.dat1<-full_join(firstflo,lastflo)
dur.dat1<-full_join(dater,dur.dat1)
dur.dat1$duration<-dur.dat1$flo_end-dur.dat1$flo_start
dur.dat1<-na.omit(dur.dat1)
D<-cbind(dur.dat,dur.dat1)
D<-rbind(dur.dat,dur.dat1)
View(D)
dur.dat1<-na.omit(dur.dat1)
setwd("~/Documents/git/proterant/FLOBUDS")
source("cleaning.R")
dater<-as.data.frame(unique(dx$id))
colnames(dater)<- c("id")
unique(dx$flophase)
d.flo<-filter(dx,flophase %in% c(60))
firstflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),min )
lastflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),max )
colnames(firstflo)<-c("id","flo_start")
colnames(lastflo)<-c("id","flo_end")
dur.dat<-full_join(firstflo,lastflo)
dur.dat<-full_join(dater,dur.dat)
dur.dat$duration<-dur.dat$flo_end-dur.dat$flo_start
dur.dat<-na.omit(dur.dat)
dur.dat$sex="bisexual"
d.flo<-filter(dx,flophase %in% c("60-F"))
firstflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),min )
lastflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),max )
colnames(firstflo)<-c("id","flo_start")
colnames(lastflo)<-c("id","flo_end")
dur.dat1<-full_join(firstflo,lastflo)
dur.dat1<-full_join(dater,dur.dat1)
dur.dat1$duration<-dur.dat1$flo_end-dur.dat1$flo_start
dur.dat1<-na.omit(dur.dat1)
dur.dat1$sex<-"female"
D<-rbind(dur.dat,dur.dat1)
View(D)
d.flo<-filter(dx,flophase %in% c("60-M"))
firstflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),min )
lastflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),max )
colnames(firstflo)<-c("id","flo_start")
colnames(lastflo)<-c("id","flo_end")
d.flo<-filter(dx,flophase %in% c("60-M"))
firstflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),min )
lastflo<-aggregate(d.flo$doy.final, by = list(d.flo$id),max )
colnames(firstflo)<-c("id","flo_start")
colnames(lastflo)<-c("id","flo_end")
dur.dat2<-full_join(firstflo,lastflo)
dur.dat2<-full_join(dater,dur.dat2)
dur.dat2$duration<-dur.dat2$flo_end-dur.dat2$flo_start
dur.dat2<-na.omit(dur.dat2)
dur.dat2$sex<-"male"
DATA<-rbind(D,dur.dat2)
View(DATA)
dxx<-dplyr::select(dx,1:7)
dxx<-distinct(dxx)
good.dat<-left_join(dater,dxx)
goober<-lef_join(DATA,dxx, by="id")
goober<-left_join(DATA,dxx, by="id")
View(goober)
ggplot(goober, aes(treatment,duration))+stat_summary(aes(color=sex))
goober<-unite(goober, treatment, Chill, Force, Light, remove=FALSE)
ggplot(goober, aes(treatment,duration))+stat_summary(aes(color=sex))
ggplot(goober, aes(treatment,duration))+stat_summary(aes(color=sex))~facet_wrap(~species)
ggplot(goober, aes(treatment,duration))+stat_summary(aes(color=sex))+facet_wrap(~species)
ggplot(goober, aes(treatment,0:120))+(aes(color=sex))
ggplot(goober, aes(treatment,duration))+(aes(color=sex))
ggplot(goober, aes(treatment,duration))+geom_point(aes(color=sex))
ggplot(goober, aes(treatment,duration))+stat_summary(aes(color=sex))+facet_wrap(~GEN.SPA)
?geom_linerange
ggplot(goober, aes(treatment,flo_start))+geom_line(aes(color=sex,ymin = flo_start, ymax = flo_end))+facet_wrap(~GEN.SPA)
ggplot(goober, aes(treatment,flo_start))+geom_line(size= 3,aes(color=sex,ymin = flo_start, ymax = flo_end))+facet_wrap(~GEN.SPA)
ggplot(goober, aes(treatment,flo_start))+geom_line(size= 1,aes(color=sex,ymin = flo_start, ymax = flo_end))+facet_wrap(~GEN.SPA)
ggplot(goober, aes(treatment,flo_start))+geom_line(aes(color=sex,ymin = flo_start, ymax = flo_end),jitter=1)+facet_wrap(~GEN.SPA)
ggplot(goober, aes(treatment,duration))+geom_bar()
ggplot(goober, aes(treatment,duration))+geom_vline(aes(duration))
ggplot(goober, aes(treatment,duration))+stat_summary()
ggplot(goober, aes(treatment,mean(duration))+stat_summary()
ggplot(goober, aes(treatment,mean(duration)))+stat_summary()
ggplot(goober, aes(treatment,mean(duration)))+stat_summary()
ggplot(goober, aes(treatment,mean(duration)))+geom_point()
ggplot(goober, aes(treatment,duration))+geom_point(aes(mean(duration)))
ggplot(goober, aes(treatment,duration))+geom_point()
ggplot(goober, aes(treatment,duration))+stat_sum(aes(sex))
ggplot(goober, aes(treatment,duration))+stat_sum(aes(color=sex))
ggplot(goober, aes(treatment,duration))+stat_summary(aes(color=sex))
ggplot(goober, aes(treatment,duration))+stat_summary(aes(group=sex))
ggplot(goober, aes(treatment,duration))+stat_summary(aes(color=sex))
ggplot(goober, aes(treatment,duration))+stat_summary(aes(color=sex))+facet_wrap(~GEN.SPA)
