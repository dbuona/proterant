HF.continuous.sum<- HF.continuous.data %>% group_by(name) %>%summarise(mean_pol=mean(cent_pol))%>%summarise(mean_flo_day=mean(cent_floday))
###phylo lm can only handle one value per species in the tree
HF.continuous.sum<- HF.continuous.data %>% group_by(name) %>%summarise(mean_pol=mean(cent_pol))
HF.continuous.sum
flo.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_floday=mean(cent_floday))
P.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_minP=mean(cent_minP))
funct.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_funct_offset=mean(funct.offset))
phys.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_phys_offset=mean(phys.offset))
?rbind()
mean.continuous.dat<-left_join(funct.sum,phys.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,P.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,flo.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,pol.sum)
###phylo lm can only handle one value per species in the tree
pol.sum<- HF.continuous.data %>% group_by(name) %>%summarise(mean_pol=mean(cent_pol))
mean.continuous.dat<-left_join(mean.continuous.dat,pol.sum)
View(mean.continuous.dat)
###phylo lm can only handle one value per species in the tree
pol.sum<- HF.continuous.data %>% group_by(name) %>%summarise(mean_pol=mean(cent_pol,na.rm=FALSE))
pol.sum
flo.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_floday=mean(cent_floday,na.rm=FALSE))
flo.sum
flo.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_floday=mean(cent_floday,na.rm=TRUE))
flo.sum
###phylo lm can only handle one value per species in the tree
pol.sum<- HF.continuous.data %>% group_by(name) %>%summarise(mean_pol=mean(cent_pol,na.rm=TRUE))
flo.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_floday=mean(cent_floday,na.rm=TRUE))
P.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_minP=mean(cent_minP,na.rm=TRUE))
funct.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_funct_offset=mean(funct.offset,na.rm=TRUE))
phys.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_phys_offset=mean(phys.offset,na.rm=TRUE))
mean.continuous.dat<-left_join(funct.sum,phys.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,P.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,flo.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,pol.sum)
clonames(mean.continuous.dat)
colnames(mean.continuous.dat)
HF.cont.funct<-phylolm(mean_funct_offset~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,data=mean.continuous.data,phy=HF.tree.pruned,boot=599)
HF.cont.funct<-phylolm(mean_funct_offset~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,data=mean.continuous.dat,phy=HF.tree.pruned,boot=599)
HF.tree.pruned$tip.label
nrow(mean.continuous.dat)
mean.continuous.dat<- mean.continuous.dat %>% remove_rownames
HF.cont.funct<-phylolm(mean_funct_offset~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,data=mean.continuous.dat,phy=HF.tree.pruned,boot=599)
HF.tree.pruned$tip.label
mean.continuous.dat$name
namelist<-mean.continuous.dat$name
namelist==mytree.names
df.cont<-[match(mytree.names, mean.continuous.dat$name),]
df.cont<-mean.continuous.dat[match(mytree.names, mean.continuous.dat$name),]
namelist<-mean.continuous.dat$name
namelist==mytree.names
mytree.namesM-
namelist<-df.cont$name
namelist<-df.cont$name
namelist==mytree.names
df$name== mytree.names
HF.cont.funct<-phylolm(mean_funct_offset~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,df.cont,phy=HF.tree.pruned,boot=599)
View(df.cont)
pol.sum<- HF.continuous.data %>% group_by(name) %>%summarise(mean_pol=mean(cent_pol,na.rm=TRUE))
flo.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_floday=mean(cent_floday,na.rm=TRUE))
P.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_minP=mean(cent_minP,na.rm=TRUE))
funct.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_funct_offset=mean(funct.offset,na.rm=TRUE))
phys.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_phys_offset=mean(phys.offset,na.rm=TRUE))
mean.continuous.dat<-left_join(funct.sum,phys.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,P.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,flo.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,pol.sum)
colnames(mean.continuous.dat)
HF.tree.pruned$tip.label
mean.continuous.dat$name
mean.continuous.dat<- mean.continuous.dat %>% remove_rownames
mytree.names<-HF.tree.pruned$tip.label
df.cont<-mean.continuous.dat[match(mytree.names, mean.continuous.dat$name),]
namelist<-df.cont$name
namelist==mytree.names
df$name== mytree.names
namelist==mytree.names
df$name== mytree.names
namelist<-df.cont$name
namelist==mytree.names
df.cont$name== mytree.names
HF.cont.funct<-phylolm(mean_funct_offset~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,df.cont,phy=HF.tree.pruned,boot=599)
df.cont$name
mytree.names
View(df.cont)
###prep the tree
treee<-read.tree("Vascular_Plants_rooted.dated.tre")
names.intree<-treee$tip.label
namelist<-unique(traits$name)
namelist<-namelist(-"Quercus_alba")
removeWords <- function(str, stopwords) {
x <- unlist(strsplit(str, " "))
paste(x[!x %in% stopwords], collapse = " ")
}
stopword<-"Quercus_alba"
removeWords(str, stopwords)
###Analysis 4cd
source("..//Scripts/continuous_mod_prep.R")
spforcontmods
HF<-filter(HF,species!=("QUAL"))
spforcontmods<-traits$species
HF.continuous.data<-filter(HF,species %in% c(spforcontmods))
HF.continuous.data<-left_join(HF.continuous.data,traits, by="species") ###This is the data for the continuous models
###Analysis 4cd
source("..//Scripts/continuous_mod_prep.R")
HF<-filter(HF,species!=("QUAL"))
spforcontmods<-traits$species
HF.continuous.data<-filter(HF,species %in% c(spforcontmods))
HF.continuous.data<-left_join(HF.continuous.data,traits, by="species") ###This is the data for the continuous models
##zscore predictors for these models
HF.continuous.data$cent_pol<-(HF.continuous.data$pol-mean(HF.continuous.data$pol,na.rm=TRUE))/(2*sd(HF.continuous.data$pol,na.rm=TRUE))
HF.continuous.data$cent_minP<-(HF.continuous.data$min_precip-mean(HF.continuous.data$min_precip))/(2*sd(HF.continuous.data$min_precip))
HF.continuous.data$cent_floday<-(HF.continuous.data$fopn.jd-mean(HF.continuous.data$fopn.jd,na.rm=TRUE))/(2*sd(HF.continuous.data$fopn.jd,na.rm=TRUE))
###phylo lm can only handle one value per species in the tree
pol.sum<- HF.continuous.data %>% group_by(name) %>%summarise(mean_pol=mean(cent_pol,na.rm=TRUE))
flo.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_floday=mean(cent_floday,na.rm=TRUE))
P.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_minP=mean(cent_minP,na.rm=TRUE))
funct.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_funct_offset=mean(funct.offset,na.rm=TRUE))
phys.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_phys_offset=mean(phys.offset,na.rm=TRUE))
mean.continuous.dat<-left_join(funct.sum,phys.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,P.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,flo.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,pol.sum)
colnames(mean.continuous.dat)
HF.tree.pruned$tip.label
mean.continuous.dat$name
mean.continuous.dat<- mean.continuous.dat %>% remove_rownames
df.cont<-mean.continuous.dat[match(mytree.names, mean.continuous.dat$name),]
namelist<-df.cont$name
namelist==mytree.names
df$name== mytree.names
HF.cont.funct<-phylolm(mean_funct_offset~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,data=mean.continuous.dat,phy=HF.tree.pruned,boot=599)
df$name== mytree.names
HF.tree.pruned$tip.label
mytree.names<-HF.tree.pruned$tip.label
mean.continuous.dat<- mean.continuous.dat %>% remove_rownames
df.cont<-mean.continuous.dat[match(mytree.names, mean.continuous.dat$name),]
namelist<-df.cont$name
namelist==mytree.names
df$name== mytree.names
df.cont$name== mytree.names
HF.cont.funct<-phylolm(mean_funct_offset~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,data=df.cont,phy=HF.tree.pruned,boot=599)
df.cont$name== mytree.names
df.cont$name
mytree.names<-HF.tree.pruned$tip.label
mytree.names
View(df.cont)
HF.cont.funct<-phylolm(mean_funct_offset~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,data=df.cont,phy=HF.tree.pruned,boot=599)
HF.tree.pruned$node.label<-NULL
HF.cont.funct<-phylolm(mean_funct_offset~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,data=df.cont,phy=HF.tree.pruned,boot=599)
df.cont$names
df.cont$name
mean.continuous.dat<- mean.continuous.dat %>% remove_rownames silv.data %>% column_to_rownames(var="name")
mean.continuous.dat<- mean.continuous.dat %>% remove_rownames %>% column_to_rownames(var="name")
###Analysis 4cd
source("..//Scripts/continuous_mod_prep.R")
HF<-filter(HF,species!=("QUAL"))
spforcontmods<-traits$species
HF.continuous.data<-filter(HF,species %in% c(spforcontmods))
HF.continuous.data<-left_join(HF.continuous.data,traits, by="species") ###This is the data for the continuous models
##zscore predictors for these models
HF.continuous.data$cent_pol<-(HF.continuous.data$pol-mean(HF.continuous.data$pol,na.rm=TRUE))/(2*sd(HF.continuous.data$pol,na.rm=TRUE))
HF.continuous.data$cent_minP<-(HF.continuous.data$min_precip-mean(HF.continuous.data$min_precip))/(2*sd(HF.continuous.data$min_precip))
HF.continuous.data$cent_floday<-(HF.continuous.data$fopn.jd-mean(HF.continuous.data$fopn.jd,na.rm=TRUE))/(2*sd(HF.continuous.data$fopn.jd,na.rm=TRUE))
###phylo lm can only handle one value per species in the tree
pol.sum<- HF.continuous.data %>% group_by(name) %>%summarise(mean_pol=mean(cent_pol,na.rm=TRUE))
flo.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_floday=mean(cent_floday,na.rm=TRUE))
P.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_minP=mean(cent_minP,na.rm=TRUE))
funct.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_funct_offset=mean(funct.offset,na.rm=TRUE))
phys.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_phys_offset=mean(phys.offset,na.rm=TRUE))
mean.continuous.dat<-left_join(funct.sum,phys.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,P.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,flo.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,pol.sum)
colnames(mean.continuous.dat)
namelist<-df.cont$name
namelist==mytree.names
colnames(mean.continuous.dat)
df.cont<-mean.continuous.dat[match(mytree.names, mean.continuous.dat$name),]
namelist<-df.cont$name
namelist==mytree.names
df.cont$name== mytree.names
df.cont$name
df.cont<- df.cont%>% remove_rownames %>% column_to_rownames(var="name")
HF.cont.funct<-phylolm(mean_funct_offset~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,data=df.cont,phy=HF.tree.pruned,boot=599)
namelist<-df.cont$name
namelist==mytree.names
###Analysis 4cd
source("..//Scripts/continuous_mod_prep.R")
HF<-filter(HF,species!=("QUAL"))
spforcontmods<-traits$species
HF.continuous.data<-filter(HF,species %in% c(spforcontmods))
HF.continuous.data<-left_join(HF.continuous.data,traits, by="species") ###This is the data for the continuous models
##zscore predictors for these models
HF.continuous.data$cent_pol<-(HF.continuous.data$pol-mean(HF.continuous.data$pol,na.rm=TRUE))/(2*sd(HF.continuous.data$pol,na.rm=TRUE))
HF.continuous.data$cent_minP<-(HF.continuous.data$min_precip-mean(HF.continuous.data$min_precip))/(2*sd(HF.continuous.data$min_precip))
HF.continuous.data$cent_floday<-(HF.continuous.data$fopn.jd-mean(HF.continuous.data$fopn.jd,na.rm=TRUE))/(2*sd(HF.continuous.data$fopn.jd,na.rm=TRUE))
###phylo lm can only handle one value per species in the tree
pol.sum<- HF.continuous.data %>% group_by(name) %>%summarise(mean_pol=mean(cent_pol,na.rm=TRUE))
flo.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_floday=mean(cent_floday,na.rm=TRUE))
P.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_minP=mean(cent_minP,na.rm=TRUE))
funct.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_funct_offset=mean(funct.offset,na.rm=TRUE))
phys.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_phys_offset=mean(phys.offset,na.rm=TRUE))
mean.continuous.dat<-left_join(funct.sum,phys.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,P.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,flo.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,pol.sum)
colnames(mean.continuous.dat)
df.cont<-mean.continuous.dat[match(mytree.names, mean.continuous.dat$name),]
namelist<-df.cont$name
namelist==mytree.names
ytree.names<-HF.tree.pruned$tip.label
mytree.names<-HF.tree.pruned$tip.label
namelist<-df.cont$name
namelist==mytree.names
mytree.names
mytree.names<-HF.tree.pruned$tip.label
df.cont<-mean.continuous.dat[match(mytree.names, mean.continuous.dat$name),]
namelist<-df.cont$name
namelist==mytree.names
df.cont$name== mytree.names
df.cont$name
df.cont<- df.cont%>% remove_rownames %>% column_to_rownames(var="name")
HF.cont.funct<-phylolm(mean_funct_offset~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,data=df.cont,phy=HF.tree.pruned,boot=599)
summary(HF.cont.funct)
HF.cont.funct<-phylolm(mean_funct_offset~mean_pol+mean_floday+mean_minP,data=df.cont,phy=HF.tree.pruned,boot=599)
summary(HF.cont.funct)
pol.sum<- HF.continuous.data %>% group_by(name) %>%summarise(mean_pol=mean(cent_pol,na.rm=TRUE))
flo.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_floday=mean(cent_floday,na.rm=TRUE))
P.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_minP=mean(cent_minP,na.rm=TRUE))
funct.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_funct_offset=mean(funct.offset,na.rm=TRUE))
phys.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_phys_offset=mean(phys.offset,na.rm=TRUE))
mean.continuous.dat<-left_join(funct.sum,phys.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,P.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,flo.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,pol.sum)
df.cont<-mean.continuous.dat[match(mytree.names, mean.continuous.dat$name),]
View(df.cont)
df.cont<- df.cont%>% remove_rownames %>% column_to_rownames(var="name")
HF.cont.funct<-phylolm(mean_funct_offset~mean_pol+mean_floday+mean_minP,data=df.cont,phy=HF.tree.pruned,boot=599)
summary(HF.cont.funct)
HF.cont.phys<-phylolm(mean_phys_offset~mean_pol+mean_floday+mean_minP,data=df.cont,phy=HF.tree.pruned,boot=599)
summary(HF.phys.funct)
summary(HF.cont.phys)
df.cont<-HF.continuous.data[match(mytree.names, mean.continuous.dat$name),]
View(df.cont)
df.cont<-HF.continuous.data[match(mytree.names, HF.continuous.data$name),]
df.cont<-mean.continuous.data[match(mytree.names, mean.continuous.dat$name),]
###phylo lm can only handle one value per species in the tree
pol.sum<- HF.continuous.data %>% group_by(name) %>%summarise(mean_pol=mean(cent_pol,na.rm=TRUE))
flo.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_floday=mean(cent_floday,na.rm=TRUE))
P.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_minP=mean(cent_minP,na.rm=TRUE))
funct.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_funct_offset=mean(funct.offset,na.rm=TRUE))
phys.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_phys_offset=mean(phys.offset,na.rm=TRUE))
mean.continuous.dat<-left_join(funct.sum,phys.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,P.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,flo.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,pol.sum)
df.cont<-mean.continuous.dat[match(mytree.names, mean.continuous.dat$name),]
df.cont<- df.cont%>% remove_rownames %>% column_to_rownames(var="name")
HF.cont.funct<-phylolm(mean_funct_offset~mean_pol+mean_floday+mean_minP,data=df.cont,phy=HF.tree.pruned,boot=599)
summary(HF.cont.funct)
HF.cont.phys<-phylolm(mean_phys_offset~mean_pol+mean_floday+mean_minP,data=df.cont,phy=HF.tree.pruned,boot=599)
summary(HF.cont.phys)
ggplot(comps.MTSV,aes(estimate,trait))+geom_point(size=4,aes(color=category),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=category))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))+xlim(-8,8)
ggplot(comps.USFS,aes(estimate,trait))+geom_point(size=4,aes(color=category),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=category))+geom_vline(aes(xintercept=0))+theme_base(base_size=11)+scale_color_manual(values=c("orchid4", "springgreen4"))+xlim(-8,8)
HF.cont.funct<-phylolm(mean_funct_offset~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,data=df.cont,phy=HF.tree.pruned,boot=599)
summary(HF.cont.funct)
HF.cont.phys<-phylolm(mean_phys_offset~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,data=df.cont,phy=HF.tree.pruned,boot=599)
summary(HF.cont.phys)
HF.fuct.continuous<-full_join(extract_coefs(HF.cont.funct),extract_CIs(HF.cont.funct),by="trait")
colnames(HF.fuct.continuous)<-c("trait","estimate","low","high")
HF.fuct.continuous$class<-"functional-MTSV"
HF.fuct.continuous$class<-"functional"
View(HF.fuct.continuous)
HF.phys.continuous<-full_join(extract_coefs(HF.cont.phys),extract_CIs(HF.cont.phys),by="trait")
colnames(HF.phys.continuous)<-c("trait","estimate","low","high")
HF.phys.continuous$class<-"physiological"
HF.cont.comps<-rbind(HF.phys.continuous,HF.fuct.continuous)
View(HF.cont.comps)
ggplot(HF.cont.comps,aes(estimate,trait))+geom_point(size=4,aes(color=category),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=category))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))+xlim(-8,8)
ggplot(HF.cont.comps,aes(estimate,trait))+geom_point(size=4,aes(color=class),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=class))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))+xlim(-8,8)
ggplot(HF.cont.comps,aes(estimate,trait))+geom_point(size=4,aes(color=class),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=class))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))
summary(HF.cont.phys)
HF.cont.comps$trait[which(HF.cont.comps$trait=="mean_pol")] <- "main effect: pollination syndrome"
HF.cont.comps$trait[which(HF.cont.comps$trait=="mean_floday")] <- "main effect: flowering time"
HF.cont.comps$trait[which(HF.cont.comps$trait=="mean_min")] <- "main effect: minimum precipitation"
HF.cont.comps$trait[which(HF.cont.comps$trait=="mean_floday:mean_minP")] <- "interaction: flowering x precip."
HF.cont.comps$trait[which(HF.cont.comps$trait=="mean_pol:mean_minP")] <- "interaction: pollination x precip."
HF.cont.comps$trait[which(HF.cont.comps$trait=="mean_pol:mean_flo_day")] <- "interaction: pollination x flowering"
ggplot(HF.cont.comps,aes(estimate,trait))+geom_point(size=4,aes(color=class),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=class))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))
HF.cont.comps<-rbind(HF.phys.continuous,HF.fuct.continuous)
HF.cont.comps$trait[which(HF.cont.comps$trait=="mean_pol")] <- "main effect: pollination syndrome"
HF.cont.comps$trait[which(HF.cont.comps$trait=="mean_floday")] <- "main effect: flowering time"
HF.cont.comps$trait[which(HF.cont.comps$trait=="mean_minP")] <- "main effect: minimum precipitation"
HF.cont.comps$trait[which(HF.cont.comps$trait=="mean_floday:mean_minP")] <- "interaction: flowering x precip."
HF.cont.comps$trait[which(HF.cont.comps$trait=="mean_pol:mean_minP")] <- "interaction: pollination x precip."
HF.cont.comps$trait[which(HF.cont.comps$trait=="mean_pol:mean_floday")] <- "interaction: pollination x flowering"
ggplot(HF.cont.comps,aes(estimate,trait))+geom_point(size=4,aes(color=class),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=class))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))
HF.cont.comps<-filter(HF.cont.comps,trait!="sigma2")
ggplot(HF.cont.comps,aes(estimate,trait))+geom_point(size=4,aes(color=class),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=class))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))
df.cont$funct.bin<-ifelse(df.cont$mean_funct_offset>=0,1,0)
df.cont$phys.bin<-ifelse(df.cont$mean_phys_offset>=0,1,0)
View(df.cont)
save.image("paper_full_analysis.RData")
HF.bin.funct<-phyloglm(funct.bin~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 100, log.alpha.bound = 10,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
z.phys.drought<-phyloglm(pro3~pol_cent+flo_cent+precip_cent+precip_cent:flo_cent+precip_cent:pol_cent+pol_cent:flo_cent,mich.data, mich.tre, method = "logistic_MPLE", btol = 50, log.alpha.bound = 10,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
HF.bin.phys<-phyloglm(phys.bin~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 100, log.alpha.bound = 10,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
HF.bin.phys<-phyloglm(phys.bin~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 150, log.alpha.bound = 10,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
summary(HF.bin.phys)
HF.bin.phys<-phyloglm(phys.bin~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 200, log.alpha.bound = 10,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
HF.bin.phys<-phyloglm(phys.bin~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 500, log.alpha.bound = 10,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
summary(HF.bin.phys)
HF.fuct.bin<-full_join(extract_coefs(HF.bin.funct),extract_CIs(HF.bin.funct),by="trait")
HF.fuct.bin<-full_join(extract_coefs(HF.bin.funct),extract_CIs(HF.bin.funct),by="trait")
HF.bin.funct<-phyloglm(funct.bin~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 100, log.alpha.bound = 10,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
HF.bin.funct<-phyloglm(funct.bin~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 50, log.alpha.bound = 10,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
HF.fuct.bin<-full_join(extract_coefs(HF.bin.funct),extract_CIs(HF.bin.funct),by="trait")
colnames(HF.fuct.bin)<-c("trait","estimate","low","high")
HF.fuct.bin$class<-"functional"
HF.phys.bin<-full_join(extract_coefs(HF.bin.phys),extract_CIs(HF.bin.phys),by="trait")
colnames(HF.phys.bin)<-c("trait","estimate","low","high")
HF.phys.bin$class<-"physiological"
HF.bin.comps<-rbind(HF.phys.bin,HF.fuct.bin)
ggplot(HF.bin.comps,aes(estimate,trait))+geom_point(size=4,aes(color=class),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=class))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))
HF.bin.funct<-phyloglm(funct.bin~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 80, log.alpha.bound = 10,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
HF.bin.funct<-phyloglm(funct.bin~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 80, log.alpha.bound = 8,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
HF.bin.funct<-phyloglm(funct.bin~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 60, log.alpha.bound = 8,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
ggplot(HF.cont.comps,aes(estimate,trait))+geom_point(size=4,aes(color=class),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=class))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))
save.image("paper_full_analysis.RData")
HF.bin.funct<-phyloglm(funct.bin~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 70, log.alpha.bound = 8,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
HF.bin.funct<-phyloglm(funct.bin~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 70, log.alpha.bound = 6,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
HF.bin.funct<-phyloglm(funct.bin~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 65, log.alpha.bound = 6,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
save.image("paper_full_analysis.RData")
ggplot(comps.MTSV,aes(estimate,trait))+geom_point(size=4,aes(color=category),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=category))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))+xlim(-8,8)
pd=position_dodgev(height=0.4)
ggplot(comps.MTSV,aes(estimate,trait))+geom_point(size=4,aes(color=category),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=category))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))+xlim(-8,8)
ggplot(comps.MTSV,aes(estimate,trait))+geom_point(size=4,aes(color=category),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=category))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))+xlim(-8,8)
ggplot(comps.USFS,aes(estimate,trait))+geom_point(size=4,aes(color=category),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=category))+geom_vline(aes(xintercept=0))+theme_base(base_size=11)+scale_color_manual(values=c("orchid4", "springgreen4"))+xlim(-8,8)
jpeg("..//figure/MTSV_effectsize.jpeg",width = 800, height = 350)
ggplot(comps.MTSV,aes(estimate,trait))+geom_point(size=4,aes(color=category),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=category))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))+xlim(-8,8)
dev.off()
jpeg("..//figure/USFS_effectsize.jpeg",width = 800, height = 350)
ggplot(comps.USFS,aes(estimate,trait))+geom_point(size=4,aes(color=category),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=category))+geom_vline(aes(xintercept=0))+theme_base(base_size=11)+scale_color_manual(values=c("orchid4", "springgreen4"))+xlim(-8,8)
dev.off()
ggplot(HF.cont.comps,aes(estimate,trait))+geom_point(size=4,aes(color=class),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=class))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))
jpeg("..//figure/HF_cont_effectsize.jpeg",width = 800, height = 350)
ggplot(HF.cont.comps,aes(estimate,trait))+geom_point(size=4,aes(color=class),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=class))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))
dev.off()
HF.bin.funct<-phyloglm(funct.bin~mean_pol+mean_floday+mean_minP+mean_pol:mean_floday+mean_pol:mean_minP+mean_floday:mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 65, log.alpha.bound = 8,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
View(funct.bin)
ggplot(HF.bin.comps,aes(estimate,trait))+geom_point(size=4,aes(color=class),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=class))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))
summary(HF.bin.funct)
HF.bin.funct<-phyloglm(funct.bin~mean_pol+mean_floday+mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 65, log.alpha.bound = 8,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
HF.bin.funct<-phyloglm(funct.bin~mean_pol+mean_floday+mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 10, log.alpha.bound = 8,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
summary(HF.bin.funct)
HF.bin.phys<-phyloglm(phys.bin~mean_pol+mean_floday+mean_minP,df.cont, HF.tree.pruned, method = "logistic_MPLE", btol = 800, log.alpha.bound = 10,
start.beta=NULL, start.alpha=NULL,
boot=599,full.matrix = TRUE)
HF.fuct.bin<-full_join(extract_coefs(HF.bin.funct),extract_CIs(HF.bin.funct),by="trait")
colnames(HF.fuct.bin)<-c("trait","estimate","low","high")
HF.fuct.bin$class<-"functional"
HF.phys.bin<-full_join(extract_coefs(HF.bin.phys),extract_CIs(HF.bin.phys),by="trait")
colnames(HF.phys.bin)<-c("trait","estimate","low","high")
HF.phys.bin$class<-"physiological"
HF.bin.comps<-rbind(HF.phys.bin,HF.fuct.bin)
ggplot(HF.bin.comps,aes(estimate,trait))+geom_point(size=4,aes(color=class),position=pd)+geom_errorbarh(position=pd,width=0,aes(xmin=low,xmax=high,color=class))+geom_vline(aes(xintercept=0))+theme_base(base_size = 11)+scale_color_manual(values=c("orchid4", "springgreen4"))
summary(HF.bin.phys)
write.csv(df.cont,"HarvardForest/HF.means.data.csv")
write.tree(HF.tree.pruned,"HarvardForest/HFtree.tre")
Phylo.Pro.phys
PhyloPro.funct
silv.Pro.phys
silv.Pro.funct
###HF phylosig
d3<-comparative.data(HF.tre,df/cont,name,vcv = TRUE,vcv.dim = 2, na.omit = FALSE)
###HF phylosig
d3<-comparative.data(HF.tre,df.cont,name,vcv = TRUE,vcv.dim = 2, na.omit = FALSE)
df.cont
###Analysis 4cd
source("..//Scripts/continuous_mod_prep.R")
HF<-filter(HF,species!=("QUAL"))
spforcontmods<-traits$species
HF.continuous.data<-filter(HF,species %in% c(spforcontmods))
HF.continuous.data<-left_join(HF.continuous.data,traits, by="species") ###This is the data for the continuous models
##zscore predictors for these models
HF.continuous.data$cent_pol<-(HF.continuous.data$pol-mean(HF.continuous.data$pol,na.rm=TRUE))/(2*sd(HF.continuous.data$pol,na.rm=TRUE))
HF.continuous.data$cent_minP<-(HF.continuous.data$min_precip-mean(HF.continuous.data$min_precip))/(2*sd(HF.continuous.data$min_precip))
HF.continuous.data$cent_floday<-(HF.continuous.data$fopn.jd-mean(HF.continuous.data$fopn.jd,na.rm=TRUE))/(2*sd(HF.continuous.data$fopn.jd,na.rm=TRUE))
###phylo lm can only handle one value per species in the tree
pol.sum<- HF.continuous.data %>% group_by(name) %>%summarise(mean_pol=mean(cent_pol,na.rm=TRUE))
flo.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_floday=mean(cent_floday,na.rm=TRUE))
P.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_minP=mean(cent_minP,na.rm=TRUE))
funct.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_funct_offset=mean(funct.offset,na.rm=TRUE))
phys.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_phys_offset=mean(phys.offset,na.rm=TRUE))
mean.continuous.dat<-left_join(funct.sum,phys.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,P.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,flo.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,pol.sum)
df.cont<-mean.continuous.dat[match(mytree.names, mean.continuous.dat$name),]
###HF phylosig
d3<-comparative.data(HF.tre,df.cont,name,vcv = TRUE,vcv.dim = 2, na.omit = FALSE)
###HF phylosig
d3<-comparative.data(HF.tre,df.cont,name,vcv = TRUE,vcv.dim = 2, na.omit = FALSE)
df.cont<-as.data.frame(df.cont)
###HF phylosig
d3<-comparative.data(HF.tre,df.cont,name,vcv = TRUE,vcv.dim = 2, na.omit = FALSE)
###HF phylosig
d3<-comparative.data(HF.tree.pruned,df.cont,name,vcv = TRUE,vcv.dim = 2, na.omit = FALSE)
#physiological hysteranthy
phylo.d(d3, binvar=phys.bin)
View(df.cont)
df.cont<-mean.continuous.dat[match(mytree.names, mean.continuous.dat$name),]
df.cont$funct.bin<-ifelse(df.cont$mean_funct_offset>=0,1,0)
df.cont$phys.bin<-ifelse(df.cont$mean_phys_offset>=0,1,0)
df.cont<-as.data.frame(df.cont)
###HF phylosig
d3<-comparative.data(HF.tree.pruned,df.cont,name,vcv = TRUE,vcv.dim = 2, na.omit = FALSE)
df.cont<- df.cont%>% remove_rownames %>% column_to_rownames(var="name")
#physiological hysteranthy
phylo.d(d3, binvar=phys.bin)
phylo.d(d3, binvar=funt.bin)
phylo.d(d3, binvar=funct.bin)
save.image("paper_full_analysis.RData")
###Analysis 4cd
source("..//Scripts/continuous_mod_prep.R")
HF<-filter(HF,species!=("QUAL"))
spforcontmods<-traits$species
HF.continuous.data<-filter(HF,species %in% c(spforcontmods))
HF.continuous.data<-left_join(HF.continuous.data,traits, by="species") ###This is the data for the continuous models
HF.continuous.data
hf.cont.noint
hf.bin.noint
###continuous models
modelcont.funct.noint <- brm(funct.offset~ cent_pol+cent_floday+cent_minP+cent_pol:cent_floday+cent_pol:cent_minP+cent_floday:cent_minP+(1|name), data = HF.continuous.data,
family = gaussian(), cov_ranef = list(name= A),iter=3000)
View(HF.continuous.data)
###Analysis 4cd
source("..//Scripts/continuous_mod_prep.R")
HF<-filter(HF,species!=("QUAL"))
spforcontmods<-traits$species
HF.continuous.data<-filter(HF,species %in% c(spforcontmods))
HF.continuous.data<-left_join(HF.continuous.data,traits, by="species") ###This is the data for the continuous models
##zscore predictors for these models
HF.continuous.data$cent_pol<-(HF.continuous.data$pol-mean(HF.continuous.data$pol,na.rm=TRUE))/(2*sd(HF.continuous.data$pol,na.rm=TRUE))
HF.continuous.data$cent_minP<-(HF.continuous.data$min_precip-mean(HF.continuous.data$min_precip))/(2*sd(HF.continuous.data$min_precip))
HF.continuous.data$cent_floday<-(HF.continuous.data$fopn.jd-mean(HF.continuous.data$fopn.jd,na.rm=TRUE))/(2*sd(HF.continuous.data$fopn.jd,na.rm=TRUE))
###phylo lm can only handle one value per species in the tree
pol.sum<- HF.continuous.data %>% group_by(name) %>%summarise(mean_pol=mean(cent_pol,na.rm=TRUE))
flo.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_floday=mean(cent_floday,na.rm=TRUE))
P.sum<- HF.continuous.data %>% group_by(name)%>%summarise(mean_minP=mean(cent_minP,na.rm=TRUE))
funct.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_funct_offset=mean(funct.offset,na.rm=TRUE))
phys.sum<-HF.continuous.data %>% group_by(name)%>%summarise(mean_phys_offset=mean(phys.offset,na.rm=TRUE))
mean.continuous.dat<-left_join(funct.sum,phys.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,P.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,flo.sum)
mean.continuous.dat<-left_join(mean.continuous.dat,pol.sum)
df.cont<-mean.continuous.dat[match(mytree.names, mean.continuous.dat$name),]
df.cont$funct.bin<-ifelse(df.cont$mean_funct_offset>=0,1,0)
df.cont$phys.bin<-ifelse(df.cont$mean_phys_offset>=0,1,0)
df.cont<-as.data.frame(df.cont)
###HF phylosig
d3<-comparative.data(HF.tree.pruned,df.cont,name,vcv = TRUE,vcv.dim = 2, na.omit = FALSE)
#physiological hysteranthy
phylo.d(d3, binvar=phys.bin)
phylo.d(d3, binvar=funct.bin)
df.cont<- df.cont%>% remove_rownames %>% column_to_rownames(var="name")
inv.phylo <- MCMCglmm::inverseA(HF.tree.pruned, nodes = "TIPS", scale = TRUE)
A <- solve(inv.phylo$Ainv)
rownames(A) <- rownames(inv.phylo$Ainv)
###continuous models
modelcont.funct.noint <- brm(funct.offset~ cent_pol+cent_floday+cent_minP+cent_pol:cent_floday+cent_pol:cent_minP+cent_floday:cent_minP+(1|name), data = HF.continuous.data,
family = gaussian(), cov_ranef = list(name= A),iter=3000)
###continuous models
modelcont.funct.noint <- brm(funct.offset~ cent_pol+cent_floday+cent_minP+cent_pol:cent_floday+cent_pol:cent_minP+cent_floday:cent_minP+(1|name), data = HF.continuous.data,
family = gaussian(), cov_ranef = list(name= A),iter=3000)
###continuous models
modelcont.funct.noint <- brm(funct.offset~ cent_pol+cent_floday+cent_minP+cent_pol:cent_floday+cent_pol:cent_minP+cent_floday:cent_minP+(1|name), data = HF.continuous.data,
family = gaussian(), cov_ranef = list(name= A),iter=3000)
